<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Cardboard Example</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body {
        margin: 0px;
        overflow: hidden;
      }
      #example {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }
    </style>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <div id="example"></div>

  <script src="js/third-party/threejs/three.js"></script>
  <script src="js/third-party/threejs/StereoEffect.js"></script>
  <script src="js/third-party/threejs/DeviceOrientationControls.js"></script>
  <script src="js/third-party/threejs/OrbitControls.js"></script>
    <script src="/fonts/optimer_regular.typeface.js"></script>

  <script>
    var camera, scene, renderer;
    var effect, controls;
    var element, container;
	var loader = new THREE.JSONLoader();
    var clock = new THREE.Clock();	
    init();
    animate();

function createText(text, x, y, z) {

        textGeo = new THREE.TextGeometry( text, {

          font: 'optimer',

          size: 10,
          height: 5

        });

        textGeo.computeBoundingBox();
        textGeo.computeVertexNormals();  

        var centerOffset = -0.5 * ( textGeo.boundingBox.max.x - textGeo.boundingBox.min.x );

        var material = new THREE.MeshPhongMaterial({color: 0xFFFFFF});
        textMesh1 = new THREE.Mesh( textGeo, material );

        textMesh1.position.x = x;
        textMesh1.position.y = y;
        textMesh1.position.z = z;

        textMesh1.rotation.x = 0;
        textMesh1.rotation.y = -90;

        scene.add( textMesh1 );


}

    function init() {
      var targetCube = new THREE.Mesh(new THREE.CubeGeometry(4, 4, 4), new THREE.MeshNormalMaterial());
      

      var socket = io();
      var count = 1;
      socket.on("chat message", function(msg){
        createText(msg, 50, 10*count, 0);
        count++;
      });
      socket.on("rotation", function(rotation){
        targetCube.rotation.x = rotation.x;
        targetCube.rotation.y = rotation.y;
        targetCube.rotation.z = rotation.z;
      });
	
		socket.on("move", function(p){
			console.log(p);
		})	
	  
	  
	  //-----------------------------------------------
	  
      renderer = new THREE.WebGLRenderer();
      element = renderer.domElement;
      container = document.getElementById('example');
      container.appendChild(element);

      effect = new THREE.StereoEffect(renderer);

      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(90, 1, 0.001, 700);
      camera.position.set(0, 10, 0);
      scene.add(camera);

      controls = new THREE.OrbitControls(camera, element);
      controls.rotateUp(Math.PI / 4);
      controls.target.set(
        camera.position.x + 0.1,
        camera.position.y,
        camera.position.z
      );
      controls.noZoom = true;
      controls.noPan = true;

      function setOrientationControls(e) {
        if (!e.alpha) {
          return;
        }

        controls = new THREE.DeviceOrientationControls(camera, true);
        controls.connect();
        controls.update();

        element.addEventListener('click', fullscreen, false);

        window.removeEventListener('deviceorientation', setOrientationControls, true);
      }
      window.addEventListener('deviceorientation', setOrientationControls, true);


      var light = new THREE.HemisphereLight(0x777777, 0x000000, 0.6);
      scene.add(light);

      var texture = THREE.ImageUtils.loadTexture(
        'textures/patterns/checker.png'
      );
      texture.wrapS = THREE.RepeatWrapping;
      texture.wrapT = THREE.RepeatWrapping;
      texture.repeat = new THREE.Vector2(50, 50);
      texture.anisotropy = renderer.getMaxAnisotropy();

      var material = new THREE.MeshPhongMaterial({
        color: 0xffffff,
        specular: 0xffffff,
        shininess: 20,
        shading: THREE.FlatShading,
        map: texture
      });

      var geometry = new THREE.PlaneGeometry(1000, 1000);

      var mesh = new THREE.Mesh(geometry, material);
      mesh.rotation.x = -Math.PI / 2;
      scene.add(mesh);

      ////ROTATIONAL CUBE
      scene.add(targetCube);
      targetCube.position.x = -10;
      targetCube.position.y = 5;



      ////---ROTATIONAL CUBE

      window.addEventListener('resize', resize, false);
      setTimeout(resize, 1);
	  
	  
	  //-----------mas modelos-----------
	  addRoom();	
	  addEye();
	  //addCalc();
	  addBB8();
	  //addIpad();
	  addNotebook();
	  addMB();
	  addEstante();
	  addPlant();
	  addBox();
	  addLights();
	  addSkyBox();
	}
	
	function addBox(){
		loader.load('models/box/box.js', function (geometry) {
			var material = new THREE.MeshLambertMaterial({
				map: THREE.ImageUtils.loadTexture('models/box/crate_1.jpg')});
			var mesh = new THREE.Mesh(
				geometry,
				material
			);
			mesh.rotation.y = -Math.PI/5;
			mesh.position.set(-5,5,-5)
			mesh.scale.set(1.3,1.3,1.3)
			scene.add(mesh);
			}
		);
	
	}
	
    function addEye(){
		loader.load('models/eye/eye.js', function (geometry) {
		var material = new THREE.MeshLambertMaterial({
			map: THREE.ImageUtils.loadTexture('models/eye/textures/eyeball_COLOR1.png')
		});
		var mesh = new THREE.Mesh(
			geometry,
			material
		);
		mesh.rotation.y = -Math.PI/5;
		mesh.position.set(-30,10,20)
		scene.add(mesh);
		}
		);
	}
	
	function addBB8(){
		loader.load('models/bb8/bb8.js', function (geometry) {
			var materials = []  
			materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/bb8/HEAD diff MAP.jpg') } ));
			materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/bb8/Head ring diff MAP.jpg') } ));
			materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/bb8/head top diff MAP.jpg') } ));
			materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/bb8/BODY diff MAP.jpg') } ));
			var meshFaceMaterial = new THREE.MeshFaceMaterial( materials );
			var mesh = new THREE.Mesh(
				geometry,
				meshFaceMaterial
			);
			mesh.rotation.y = -Math.PI/5;
			mesh.position.set(-10,10,20)
			mesh.scale.set(0.1,0.1,0.1)
			scene.add(mesh);
		}
		);
	}
	
	function addNotebook(){
		loader.load('models/notebook/notebook.js', function (geometry) {
			var material = new THREE.MeshLambertMaterial({
				map: THREE.ImageUtils.loadTexture('models/notebook/Bake_Col_3.jpg')});
			var mesh = new THREE.Mesh(
				geometry,
				material
			);
			mesh.rotation.y = -Math.PI/5;
			mesh.position.set(10,10,20)
			scene.add(mesh);
		}
		);
	}
	
	function addMB(){
		loader.load('models/mb/mb.js', function (geometry) {
			  // create a new material
			var material = new THREE.MeshLambertMaterial({
			map: THREE.ImageUtils.loadTexture('models/mb/Backgroung.png')});
		  var mesh = new THREE.Mesh(
			geometry,
			material
		  );			  
		  mesh.rotation.y = -Math.PI/5;
		  mesh.position.set(30,10,20)
		  mesh.scale.set(0.05,0.05,0.05)
		  scene.add(mesh);
		  }
			);
	
	}
	
	/**NO FUNCIONA*/
	function addIpad(){
	// init loading
		loader.load('models/ipad/ipad.js', function (geometry) {
		  // create a new material
		var materials = []  
		materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/ipad/Home Button.jpg') } ));
	/*	materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/ipad/Ipad Back.psd') } ));
		materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/ipad/logo.psd') } ));
		materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/ipad/screen big.psd') } ));
		materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/ipad/Screen.psd') } ));
		materials.push(new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('models/ipad/speaker mesh.psd') } ));
		*/
		
		
		  // create a mesh with models geometry and material
		   var meshFaceMaterial = new THREE.MeshFaceMaterial( materials );
		  var mesh = new THREE.Mesh(
			geometry,
			meshFaceMaterial
		  );
		  
		  mesh.rotation.y = -Math.PI/5;
		  mesh.position.x -= 500
		  mesh.scale.set(0.3,0.3,0.3)
		  scene.add(mesh);
		  }
		);
	}
	
	function addEstante(){
		var geometry = new THREE.BoxGeometry( 80, 6, 6 );
		texture = THREE.ImageUtils.loadTexture('textures/metal.jpg');
		var material = new THREE.MeshBasicMaterial( { color: 0x3F3F3F, map: texture} );
		var cube = new THREE.Mesh( geometry, material );
		cube.position.set(0,6,20)
		scene.add( cube );

	}
	
	function addRoom(){
		function createWall(){
			var material = new THREE.MeshPhongMaterial({
				color: 0xffffff,
				specular: 0xffffff,
				shininess: 20,
				shading: THREE.FlatShading,
			});
			var geometry = new THREE.PlaneGeometry(400, 400);
			var mesh = new THREE.Mesh(geometry, material);
			mesh.material.side = THREE.DoubleSide;
			material.doubleSided = true;
			return mesh;
		}
      
	  wall1 = createWall();
	  wall1.position.z -= 200
	  
      wall2 = createWall();
	  wall2.position.z += 200
	  
	  wall3 = createWall();
	  wall3.rotation.y -= Math.PI / 2;
	  wall3.position.x -= 200;
	  
	  wall4 = createWall();
	  wall4.rotation.y -= Math.PI /2;
	  wall4.position.x += 200
	 
	  scene.add(wall1)
	  scene.add(wall2)
	  scene.add(wall3)
	  scene.add(wall4)
	}
	
	/**no se ve nada*/
	function addSkyBox(){
		
		var imagePrefix = "skybox/dawnmountain-";
		var directions  = ["xpos", "xneg", "ypos", "yneg", "zpos", "zneg"];
		var imageSuffix = ".png";
		var skyGeometry = new THREE.CubeGeometry( 5000, 5000, 5000 );	
		
		var materialArray = [];
		for (var i = 0; i < 6; i++)
			materialArray.push( new THREE.MeshBasicMaterial({
				map: THREE.ImageUtils.loadTexture( imagePrefix + directions[i] + imageSuffix ),
				side: THREE.BackSide
			}));
		var skyMaterial = new THREE.MeshFaceMaterial( materialArray );
		var skyBox = new THREE.Mesh( skyGeometry, skyMaterial );
		scene.add( skyBox );
	
	}
	
	function addPlant(){
		loader.load('models/plant/plant.js', function (geometry) {
			 
			var material = new THREE.MeshLambertMaterial({
				map: THREE.ImageUtils.loadTexture('models/plant/MARBLE_1.jpg')});
		  var mesh = new THREE.Mesh(
			geometry,
			material
		  );			  
		  mesh.rotation.y = -Math.PI/5;
		  mesh.position.set(3,1,-20)
		  mesh.scale.set(0.05,0.05,0.05)
		  scene.add(mesh);
		  }
			);
	
	}
	
	/** USELESS (ENORME, NO ME FUNCIONA EL SCALE)*/
	function addCalc(){
		// init loading
		loader.load('models/calc/calc.js', function (geometry) {
		  // create a new material
		  var material = new THREE.MeshLambertMaterial({
			//map: THREE.ImageUtils.loadTexture('models/calc/textures'),		// specify and load the texture
			colorAmbient: [0.480000026226044, 0.480000026226044, 0.480000026226044],
			colorDiffuse: [0.480000026226044, 0.480000026226044, 0.480000026226044],
			colorSpecular: [0.8999999761581421, 0.8999999761581421, 0.8999999761581421]
		  });
		  
		  // create a mesh with models geometry and material
		  var mesh = new THREE.Mesh(
			geometry,
			material
		  );
		  
		  mesh.rotation.y = -Math.PI/5;
		  mesh.position.x -= 5
		  mesh.scale.set = (0.1,0.1,0.1)
		  scene.add(mesh);
		  }
		);
	}
	
	function addLights() {
		var dirLight = new THREE.DirectionalLight(0xffffff, 1);
		dirLight.position.set(100, 100, 50);
		scene.add(dirLight);
	}
	
    function resize() {
      var width = container.offsetWidth;
      var height = container.offsetHeight;

      camera.aspect = width / height;
      camera.updateProjectionMatrix();

      renderer.setSize(width, height);
      effect.setSize(width, height);
    }

    function update(dt) {

      resize();

      camera.updateProjectionMatrix();

      controls.update(dt);
	  
    }

    function render(dt) {
      effect.render(scene, camera);
    }

    function animate(t) {
      requestAnimationFrame(animate);

      update(clock.getDelta());
      render(clock.getDelta());
    }

    function fullscreen() {
      if (container.requestFullscreen) {
        container.requestFullscreen();
      } else if (container.msRequestFullscreen) {
        container.msRequestFullscreen();
      } else if (container.mozRequestFullScreen) {
        container.mozRequestFullScreen();
      } else if (container.webkitRequestFullscreen) {
        container.webkitRequestFullscreen();
      }
    }
  </script>
  </body>
</html>


