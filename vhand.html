<!doctype html>
<html>
  <head>
    <title>VirtualHand</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/third-party/threejs/three.js"></script>

  </head>
  <body>
    <script>
      var socket = io();
      window.addEventListener('deviceorientation', onDeviceOrientationChangeEvent, false);
      var force;
      var timestamp;
      var lastY;
      document.addEventListener('touchstart', function(e){
        timestamp = Date.now();
        console.log(e);
        force = e.touches[0].pageY;
        lastY = force;
        socket.emit("pick");
      }, false);
      document.addEventListener('touchmove',function(e){
        lastY = e.touches[0].pageY;
      });
      document.addEventListener('touchend', function(e){
        timestamp = Date.now() - timestamp;
        force = Math.abs(force -lastY);
        if(parseInt(force) < 30)
          socket.emit("drop");
        else
          socket.emit("throw", {force: force, time: timestamp});
      }, true);

      var rotation = {alpha:"", beta:"", gamma:""};
       function onDeviceOrientationChangeEvent(evt){
        
        rotation.alpha = evt.gamma ? evt.alpha : 0; // Z
        rotation.beta = evt.beta ? evt.beta : 0; // X'
        rotation.gamma = evt.gamma ? evt.gamma : 0; // Y''

        
      }
      setInterval(function(){
        socket.emit('rotation', rotation);
      },100);


    </script>
  </body>
</html>